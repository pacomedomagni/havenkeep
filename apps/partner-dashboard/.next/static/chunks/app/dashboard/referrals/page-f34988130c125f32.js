(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[580],{75566:function(e,t,r){Promise.resolve().then(r.bind(r,33347))},40257:function(e,t,r){"use strict";var n,a;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(44227)},44227:function(e){!function(){var t={229:function(e){var t,r,n,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var o=[],c=!1,d=-1;function u(){c&&n&&(c=!1,n.length?o=n.concat(o):d=-1,o.length&&h())}function h(){if(!c){var e=l(u);c=!0;for(var t=o.length;t;){for(n=o,o=[];++d<t;)n&&n[d].run();d=-1,t=o.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function x(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new x(e,t)),1!==o.length||c||l(h)},x.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var s=r[e]={exports:{}},i=!0;try{t[e](s,s.exports,n),i=!1}finally{i&&delete r[e]}return s.exports}n.ab="//";var a=n(229);e.exports=a}()},33347:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var n=r(57437),a=r(2265);function s(e){let{status:t}=e;return(0,n.jsx)("span",{className:"converted"===t?"badge-converted":"pending"===t?"badge-pending":"badge-expired",children:t.charAt(0).toUpperCase()+t.slice(1)})}function i(e){let{referrals:t}=e,[r,i]=(0,a.useState)("createdAt"),[l,o]=(0,a.useState)("desc");function c(e){e===r?o("asc"===l?"desc":"asc"):(i(e),o("desc"))}let d=[...t].sort((e,t)=>{var n,a;let s=null!==(n=e[r])&&void 0!==n?n:"",i=null!==(a=t[r])&&void 0!==a?a:"",o=s>i?1:s<i?-1:0;return"asc"===l?o:-o}),u=e=>{let{field:t}=e;return(0,n.jsx)("span",{className:"ml-1 text-haven-text-tertiary",children:r===t?"asc"===l?"↑":"↓":"↕"})};return(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"border-b border-haven-border",children:[(0,n.jsxs)("th",{className:"text-left py-3 px-4 text-xs font-medium text-haven-text-tertiary uppercase tracking-wider cursor-pointer hover:text-haven-text-secondary",onClick:()=>c("code"),children:["Code ",(0,n.jsx)(u,{field:"code"})]}),(0,n.jsx)("th",{className:"text-left py-3 px-4 text-xs font-medium text-haven-text-tertiary uppercase tracking-wider",children:"Referred Email"}),(0,n.jsxs)("th",{className:"text-left py-3 px-4 text-xs font-medium text-haven-text-tertiary uppercase tracking-wider cursor-pointer hover:text-haven-text-secondary",onClick:()=>c("status"),children:["Status ",(0,n.jsx)(u,{field:"status"})]}),(0,n.jsxs)("th",{className:"text-left py-3 px-4 text-xs font-medium text-haven-text-tertiary uppercase tracking-wider cursor-pointer hover:text-haven-text-secondary",onClick:()=>c("createdAt"),children:["Created ",(0,n.jsx)(u,{field:"createdAt"})]}),(0,n.jsxs)("th",{className:"text-left py-3 px-4 text-xs font-medium text-haven-text-tertiary uppercase tracking-wider cursor-pointer hover:text-haven-text-secondary",onClick:()=>c("convertedAt"),children:["Converted At ",(0,n.jsx)(u,{field:"convertedAt"})]})]})}),(0,n.jsxs)("tbody",{className:"divide-y divide-haven-border",children:[d.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-haven-elevated/50 transition-colors",children:[(0,n.jsx)("td",{className:"py-3 px-4 text-sm font-mono text-haven-primary",children:e.code}),(0,n.jsx)("td",{className:"py-3 px-4 text-sm text-haven-text-secondary",children:e.referredEmail||"—"}),(0,n.jsx)("td",{className:"py-3 px-4",children:(0,n.jsx)(s,{status:e.status})}),(0,n.jsx)("td",{className:"py-3 px-4 text-sm text-haven-text-secondary",children:new Date(e.createdAt).toLocaleDateString()}),(0,n.jsx)("td",{className:"py-3 px-4 text-sm text-haven-text-secondary",children:e.convertedAt?new Date(e.convertedAt).toLocaleDateString():"—"})]},e.id)),0===d.length&&(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:5,className:"py-8 text-center text-haven-text-tertiary",children:"No referrals found"})})]})]})})}let l=a.forwardRef(function(e,t){let{title:r,titleId:n,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?a.createElement("title",{id:n},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}),o=a.forwardRef(function(e,t){let{title:r,titleId:n,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?a.createElement("title",{id:n},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}),c=a.forwardRef(function(e,t){let{title:r,titleId:n,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?a.createElement("title",{id:n},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5A3.375 3.375 0 0 0 6.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0 0 15 2.25h-1.5a2.251 2.251 0 0 0-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 0 0-9-9Z"}))});var d=r(71837),u=r(40257);function h(e){let{isOpen:t,onClose:r}=e,[s,i]=(0,a.useState)(null),[h,x]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),[f,v]=(0,a.useState)(null);async function b(){p(!0),v(null);try{let e=await (0,d.x1)("/api/v1/partners/referral-code",{method:"POST"});if(e.success&&e.data)i(e.data.referral_code);else{let e="HK-".concat(Math.random().toString(36).substring(2,6).toUpperCase(),"-").concat(Math.random().toString(36).substring(2,6).toUpperCase());i(e)}}catch(e){i("HK-".concat(Math.random().toString(36).substring(2,6).toUpperCase(),"-").concat(Math.random().toString(36).substring(2,6).toUpperCase()))}finally{p(!1)}}async function y(e){try{await navigator.clipboard.writeText(e),x(!0),setTimeout(()=>x(!1),2e3)}catch(e){}}function g(){i(null),x(!1),r()}if(!t)return null;let j=s?"".concat(u.env.NEXT_PUBLIC_APP_URL||"https://havenkeep.app","/referral/").concat(s):"";return(0,n.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 px-4",children:(0,n.jsxs)("div",{className:"bg-haven-surface border border-haven-border rounded-xl w-full max-w-md p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Generate Referral Code"}),(0,n.jsx)("button",{onClick:g,className:"text-haven-text-tertiary hover:text-white transition-colors",children:(0,n.jsx)(l,{className:"w-5 h-5"})})]}),s?(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs font-medium text-haven-text-tertiary uppercase tracking-wider mb-2",children:"Your Referral Code"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"flex-1 bg-haven-elevated border border-haven-border rounded-lg px-4 py-3 font-mono text-lg text-haven-primary text-center",children:s}),(0,n.jsx)("button",{onClick:()=>y(s),className:"p-3 bg-haven-elevated border border-haven-border rounded-lg hover:bg-haven-primary/15 transition-colors",title:"Copy code",children:h?(0,n.jsx)(o,{className:"w-5 h-5 text-haven-active"}):(0,n.jsx)(c,{className:"w-5 h-5 text-haven-text-secondary"})})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs font-medium text-haven-text-tertiary uppercase tracking-wider mb-2",children:"Shareable Link"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{type:"text",value:j,readOnly:!0,className:"input-field text-sm font-mono"}),(0,n.jsx)("button",{onClick:()=>y(j),className:"p-3 bg-haven-elevated border border-haven-border rounded-lg hover:bg-haven-primary/15 transition-colors shrink-0",title:"Copy link",children:(0,n.jsx)(c,{className:"w-5 h-5 text-haven-text-secondary"})})]})]}),(0,n.jsx)("button",{onClick:g,className:"btn-secondary w-full mt-2",children:"Done"})]}):(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-haven-text-secondary text-sm mb-6",children:"Generate a unique referral code to share with your clients. You'll earn a commission for every user who signs up with your code."}),(0,n.jsx)("button",{onClick:b,disabled:m,className:"btn-primary w-full",children:m?(0,n.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,n.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Generating..."]}):"Generate Code"})]})]})})}let x=a.forwardRef(function(e,t){let{title:r,titleId:n,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},s),r?a.createElement("title",{id:n},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}),m=[{label:"All",value:"all"},{label:"Pending",value:"pending"},{label:"Converted",value:"converted"},{label:"Expired",value:"expired"}];function p(){let[e,t]=(0,a.useState)([]),[r,s]=(0,a.useState)(!0),[l,o]=(0,a.useState)(null),[c,u]=(0,a.useState)("all"),[p,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{v()},[]);let v=async()=>{try{o(null);let e=await (0,d.x1)("/api/v1/partners/gifts");if(e.success){let r=(e.data||[]).map(e=>({id:e.id,partnerId:e.partner_id,code:e.activation_code||e.id.substring(0,12).toUpperCase(),referredEmail:e.homebuyer_email,referredUserId:e.activated_user_id,status:e.is_activated?"converted":e.expires_at&&new Date(e.expires_at)<new Date?"expired":"pending",convertedAt:e.activated_at,createdAt:e.created_at}));t(r)}}catch(e){o("Failed to load referrals. Please try again."),console.error("Error fetching referrals:",e)}finally{s(!1)}},b="all"===c?e:e.filter(e=>e.status===c);return r?(0,n.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-haven-primary"})}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Referrals"}),(0,n.jsx)("p",{className:"text-haven-text-secondary text-sm mt-1",children:"Manage and track your referral codes"})]}),(0,n.jsxs)("button",{onClick:()=>f(!0),className:"btn-primary inline-flex items-center gap-2",children:[(0,n.jsx)(x,{className:"w-4 h-4"}),"Generate Code"]})]}),l&&(0,n.jsxs)("div",{className:"bg-haven-error/10 border border-haven-error/30 rounded-lg p-4 text-haven-error text-sm",children:[l,(0,n.jsx)("button",{onClick:v,className:"ml-2 underline",children:"Retry"})]}),(0,n.jsx)("div",{className:"flex gap-2",children:m.map(t=>(0,n.jsxs)("button",{onClick:()=>u(t.value),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ".concat(c===t.value?"bg-haven-primary text-white":"bg-haven-surface text-haven-text-secondary hover:bg-haven-elevated hover:text-white border border-haven-border"),children:[t.label,(0,n.jsxs)("span",{className:"ml-1.5 text-xs opacity-70",children:["(","all"===t.value?e.length:e.filter(e=>e.status===t.value).length,")"]})]},t.value))}),(0,n.jsx)("div",{className:"card p-0 overflow-hidden",children:(0,n.jsx)(i,{referrals:b})}),(0,n.jsx)(h,{isOpen:p,onClose:()=>{f(!1),v()}})]})}},71837:function(e,t,r){"use strict";r.d(t,{kS:function(){return i},x1:function(){return a}});let n=r(40257).env.NEXT_PUBLIC_API_URL||"";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{method:r="GET",body:a,headers:i={}}=t,l={method:r,credentials:"include",headers:{"Content-Type":"application/json",...i}};a&&"GET"!==r&&(l.body=JSON.stringify(a));let o=e.startsWith("http")?e:"".concat(n).concat(e),c=await fetch(o,l);if(!c.ok){let e=await c.json().catch(()=>({}));throw new s(e.message||e.error||"Request failed with status ".concat(c.status),c.status)}return c.json()}class s extends Error{constructor(e,t){super(e),this.status=t,this.name="ApiError"}}async function i(){await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),window.location.href="/login"}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=75566)}),_N_E=e.O()}]);